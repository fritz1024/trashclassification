# 垃圾分类识别小程序

基于 uni-app 开发的垃圾分类识别小程序，支持微信小程序、支付宝小程序等多端平台。

## 功能特性

- ✅ **图片识别**：支持单张和批量图片识别
- ✅ **识别历史**：查看个人识别记录
- ✅ **数据统计**：可视化展示识别数据
- ✅ **AI 助手**：智能问答垃圾分类问题
- ✅ **用户系统**：登录注册、游客模式

## 技术栈

- **框架**：uni-app (Vue 3)
- **构建工具**：Vite
- **后端 API**：复用现有 FastAPI 后端

## 快速开始

### 1. 安装依赖

```bash
cd miniprogram
npm install
```

### 2. 配置后端地址

编辑 `utils/config.js` 文件，修改 `baseURL` 为你的后端地址：

```javascript
export const config = {
  baseURL: 'http://localhost:8000',  // 开发环境
  // baseURL: 'https://your-domain.com',  // 生产环境
  timeout: 30000
}
```

### 3. 运行项目

#### 微信小程序

```bash
npm run dev:mp-weixin
```

然后使用微信开发者工具打开 `dist/dev/mp-weixin` 目录。

#### 支付宝小程序

```bash
npm run dev:mp-alipay
```

然后使用支付宝开发者工具打开 `dist/dev/mp-alipay` 目录。

### 4. 构建生产版本

```bash
# 微信小程序
npm run build:mp-weixin

# 支付宝小程序
npm run build:mp-alipay
```

## 项目结构

```
miniprogram/
├── pages/              # 页面文件
│   ├── index/         # 图片识别页面
│   ├── history/       # 识别历史页面
│   ├── stats/         # 数据统计页面
│   ├── chat/          # AI 聊天页面
│   └── login/         # 登录注册页面
├── api/               # API 接口
│   ├── auth.js       # 认证接口
│   ├── predict.js    # 识别接口
│   ├── stats.js      # 统计接口
│   └── chat.js       # 聊天接口
├── utils/             # 工具函数
│   ├── config.js     # 配置文件
│   └── request.js    # 请求封装
├── static/            # 静态资源
│   ├── images/       # 图片资源
│   └── styles/       # 全局样式
├── App.vue           # 应用入口
├── main.js           # 主入口文件
├── pages.json        # 页面配置
├── manifest.json     # 应用配置
└── vite.config.js    # Vite 配置
```

## 配置说明

### 1. 小程序 AppID 配置

编辑 `manifest.json` 文件，填入你的小程序 AppID：

```json
{
  "mp-weixin": {
    "appid": "你的微信小程序AppID"
  },
  "mp-alipay": {
    "appid": "你的支付宝小程序AppID"
  }
}
```

### 2. 权限配置

小程序需要以下权限：
- 相机权限（拍照识别）
- 相册权限（选择图片）

这些权限已在 `manifest.json` 中配置。

### 3. 服务器域名配置

在小程序后台配置以下域名白名单：
- request 合法域名：你的后端 API 域名
- uploadFile 合法域名：你的后端 API 域名

## 功能说明

### 图片识别

- **单张识别**：支持拍照或从相册选择图片进行识别
- **批量识别**：一次最多可选择 9 张图片进行批量识别（需登录）
- **识别结果**：显示 Top-3 预测结果及置信度

### 识别历史

- 查看个人所有识别记录
- 支持下拉刷新和上拉加载更多
- 可删除单条记录

### 数据统计

- 识别次数统计
- 分类占比可视化
- 最近识别记录

### AI 助手

- 智能问答垃圾分类相关问题
- 实时对话
- 支持多轮对话

## 注意事项

1. **后端服务**：确保后端服务已启动并可访问
2. **网络请求**：小程序只能请求 HTTPS 接口（开发环境可配置不校验）
3. **图片大小**：建议单张图片不超过 10MB
4. **登录状态**：部分功能需要登录后使用

## 开发建议

1. **调试**：使用微信/支付宝开发者工具的调试功能
2. **真机测试**：建议在真机上测试相机和相册功能
3. **性能优化**：注意图片压缩和请求优化

## 常见问题

### Q1: 无法连接后端？
A: 检查 `utils/config.js` 中的 `baseURL` 配置是否正确，确保后端服务已启动。

### Q2: 图片上传失败？
A: 检查图片大小是否超过限制，确保后端接口正常。

### Q3: 小程序无法预览？
A: 确保已在 `manifest.json` 中配置正确的 AppID。

### Q4: 真机调试网络请求失败？
A: 需要在小程序后台配置服务器域名白名单，或在开发者工具中勾选"不校验合法域名"。

## 后续优化

- [ ] 添加图片压缩功能
- [ ] 优化加载动画
- [ ] 添加分享功能
- [ ] 支持更多小程序平台
- [ ] 添加离线缓存

## 许可证

MIT License
